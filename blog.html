<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Page</title>
</head>
<body>
    <h1>Post Page</h1>
    
    <!-- Form for posting new content -->
    <form id="postForm">
        <label for="username">Username:</label>
        <input type="text" id="username" required><br><br>
        
        <label for="postContent">Post:</label><br>
        <textarea id="postContent" required></textarea><br><br>
        
        <button type="submit">Submit Post</button>
    </form>
    
    <!-- Container for displaying posts -->
    <div id="postsContainer">
        <h2>Recent Posts</h2>
        <ul id="postsList"></ul>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        const SUPABASE_URL = 'https://uymohtxakjtqlpvgxckg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5bW9odHhha2p0cWxwdmd4Y2tnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTE3Mzk4OTgsImV4cCI6MjAyNzMxNTg5OH0.OqNq1Ai0OLLs_8x_pUijvqlUIny4wrQGW80puOQJHGY';

        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Function to handle form submission for posting new content
        async function submitPost(event) {
            event.preventDefault(); // Prevent default form submission
            
            // Get values from form fields
            const username = document.getElementById('username').value;
            const postContent = document.getElementById('postContent').value;

            try {
                // Insert new post into the database
                const { data, error } = await supabase
                    .from('posts')
                    .insert([{ username, post: postContent }]);
                
                if (error) {
                    console.error('Error submitting post:', error.message);
                } else {
                    console.log('Post submitted successfully:', data);
                    // Clear form fields after successful submission
                    document.getElementById('username').value = '';
                    document.getElementById('postContent').value = '';
                    // Refresh posts list to display the new post
                    fetchAndDisplayPosts();
                }
            } catch (error) {
                console.error('Error submitting post:', error.message);
            }
        }

        // Function to fetch and display posts from the database
        async function fetchAndDisplayPosts() {
            try {
                const { data, error } = await supabase
                    .from('posts')
                    .select('*');

                if (error) {
                    console.error('Error fetching posts:', error.message);
                } else {
                    // Clear existing posts list
                    const postsList = document.getElementById('postsList');
                    postsList.innerHTML = '';

                    // Display fetched posts
                    data.forEach(post => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${post.username} (${post.timestamp}): ${post.post}`;
                        postsList.appendChild(listItem);
                    });
                }
            } catch (error) {
                console.error('Error fetching posts:', error.message);
            }
        }

        // Event listener for form submission
        const postForm = document.getElementById('postForm');
        postForm.addEventListener('submit', submitPost);

        // Fetch and display posts when the page loads
        fetchAndDisplayPosts();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Blog Posting</title>
</head>
<body>
    <h1>Real-time Blog Posting</h1>
    <textarea id="postContent" placeholder="Enter your blog post here"></textarea>
    <button onclick="submitPost()">Submit Post</button>

    <div id="posts"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        const SUPABASE_URL = 'https://uymohtxakjtqlpvgxckg.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5bW9odHhha2p0cWxwdmd4Y2tnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTE3Mzk4OTgsImV4cCI6MjAyNzMxNTg5OH0.OqNq1Ai0OLLs_8x_pUijvqlUIny4wrQGW80puOQJHGY';

        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        async function submitPost() {
            const postContent = document.getElementById('postContent').value;

            try {
                const { data, error } = await supabase
                    .from('posts')
                    .insert([{ content: postContent }]);

                if (error) {
                    console.error('Error submitting post:', error.message);
                } else {
                    console.log('Post submitted successfully:', data);
                }
            } catch (error) {
                console.error('Error submitting post:', error.message);
            }
        }

        const postsDiv = document.getElementById('posts');

        const subscription = supabase
            .from('posts')
            .on('INSERT', payload => {
                const newPost = payload.new;
                const postElement = document.createElement('div');
                postElement.textContent = newPost.content;
                postsDiv.prepend(postElement);
            })
            .subscribe();

        // Clean up the subscription when the page unloads
        window.addEventListener('beforeunload', () => {
            subscription.unsubscribe();
        });
    </script>
</body>
</html>
